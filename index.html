<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Catálogo Mayorista</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<style>
:root{
  --bg:#f6f8fb;
  --text:#222;
  --accent:#FFB800;      /* Amarillo tipo Amazon */
  --accent-border:#FFD800;
  --muted:#b2b2b2;
  --card-border:#eee;
}
/* Reset básico */
*{box-sizing:border-box}
html,body{margin:0;padding:0}
body{background:var(--bg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif}

/* Encabezado oferta: ancho completo + movimiento lento, repite la frase múltiples veces */
.header-oferta{
  width:100%;
  background:var(--accent);
  color:var(--text);
  border-bottom:2px solid var(--accent-border);
  box-shadow:0 2px 10px rgba(0,0,0,.06);
  overflow:hidden;
  position:sticky; top:0; z-index:50;
}
.header-track{
  display:flex; gap:64px; white-space:nowrap;
  animation:marquee 24s linear infinite;
  padding:10px 0;
  font-weight:900; font-size:1.02rem; letter-spacing:.3px;
}
.header-item{display:inline-flex;align-items:center;gap:10px;padding-left:24px}
.header-item i{color:#c07a00}
@keyframes marquee{
  0%{transform:translateX(100%)}
  100%{transform:translateX(-100%)}
}

/* Layout principal: barra lateral de categorías a la izquierda (PC), contenido a la derecha */
.main{
  max-width:1600px; margin:0 auto;
  display:grid; grid-template-columns:260px 1fr; gap:18px;
  padding:16px 24px;
}
@media (max-width:992px){
  .main{grid-template-columns:1fr}
}

/* Sidebar categorías: fija a la izquierda en PC */
.sidebar{
  background:#fff; border:1px solid var(--card-border); border-radius:12px;
  padding:14px; position:sticky; top:60px; height:max-content;
}
.sidebar h2{
  margin:0 0 10px; font-size:1.02rem; font-weight:900; color:var(--text);
}
#menu-cat{display:flex; flex-direction:column; gap:8px}
.btn-cat{
  background:#fff; color:var(--accent);
  border:1.6px solid var(--accent-border);
  font-weight:700; border-radius:12px; padding:9px 12px; cursor:pointer; transition:.15s;
  font-size:.98rem; text-align:left;
}
.btn-cat.active{
  background:var(--accent); color:var(--text);
  box-shadow:0 2px 8px rgba(255,216,0,.35)
}

/* Toolbar superior del contenido: buscador en línea */
.toolbar{
  background:#fff; border:1px solid var(--card-border); border-radius:12px;
  padding:12px; display:flex; align-items:center; gap:12px; flex-wrap:wrap; justify-content:flex-start;
}
#searchBox{
  flex:1 1 340px; min-width:280px; max-width:100%;
  border:1.4px solid var(--accent-border);
  border-radius:12px; padding:10px 14px; font-size:1rem;
  box-shadow:0 2px 8px rgba(255,216,0,.12)
}

/* Grid de productos: 5 columnas en desktop, respondiendo hacia abajo */
.grid{display:grid; gap:18px; grid-template-columns:repeat(5,minmax(0,1fr))}
@media (max-width:1400px){.grid{grid-template-columns:repeat(4,1fr)}}
@media (max-width:992px){.grid{grid-template-columns:repeat(2,1fr)}}
@media (max-width:576px){.grid{grid-template-columns:repeat(1,1fr)}}

/* Card de producto */
.card{
  background:#fff; border:1.3px solid var(--card-border); border-radius:14px;
  box-shadow:0 6px 18px rgba(255,216,0,.12);
  display:flex; flex-direction:column; min-width:0; overflow:hidden; position:relative;
}
.card:hover{box-shadow:0 10px 28px rgba(255,216,0,.22)}

/* Imagen */
.img-box{
  background:linear-gradient(180deg,#faf7fc 60%,#fff 100%);
  padding:16px; display:flex; align-items:center; justify-content:center; min-height:170px;
}
.img-box img{
  max-width:100%; max-height:170px; object-fit:contain; border-radius:10px
}

/* MOQ badge: siempre dentro del card, arriba a la derecha, no se corta */
.moq{
  position:absolute; top:10px; right:10px;
  background:var(--accent); color:var(--text);
  border:1px solid var(--accent-border);
  border-radius:10px; padding:6px 12px; font-weight:800; font-size:.9rem; z-index:2;
}

/* Información */
.info{padding:12px 14px}
.title{font-size:1.02rem; font-weight:800; color:var(--text); margin:0 0 2px}
.ref{font-size:.93rem; color:#ff8a00; font-weight:700; margin:0 0 8px}
.prices{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
.old{color:var(--muted); text-decoration:line-through; font-size:.95rem}
.price{color:var(--text); font-weight:900; font-size:1.16rem}

/* CTA PRECIO MAYOR: amarillo Amazon, SIEMPRE visible, icono llama (oferta/liquidación) */
.cta{
  background:var(--accent); color:var(--text);
  border:1px solid var(--accent-border);
  border-radius:9px; padding:6px 12px; font-weight:900;
  display:inline-flex; align-items:center; gap:6px; font-size:.95rem
}
.cta i{font-size:1.05rem; color:#d1322b} /* rojo oferta/liquidación */

/* Mobile: mantener todo en la misma línea sin cortes */
@media (max-width:576px){
  .prices{flex-wrap:nowrap; gap:8px}
  .title{font-size:1.05rem}
  .price{font-size:1.18rem}
}

/* WhatsApp flotante */
.whatsapp{
  position:fixed; right:16px; bottom:16px; z-index:1000;
  background:linear-gradient(90deg,#25D366 80%,#128C7E 120%);
  color:#fff; border-radius:24px; padding:12px 18px; font-weight:800; font-size:.98rem;
  display:flex; align-items:center; gap:8px; text-decoration:none; box-shadow:0 6px 18px rgba(0,0,0,.12)
}

/* En móvil: la barra lateral se vuelve un bloque arriba; categorías quedan debajo del header y encima del grid */
@media (max-width:992px){
  .sidebar{position:static}
  #menu-cat{flex-direction:row; flex-wrap:wrap}
}
</style>
</head>
<body>

<!-- Encabezado oferta con movimiento lento y la frase repetida varias veces -->
<div class="header-oferta">
  <div class="header-track">
    <div class="header-item"><i class="bi bi-truck"></i> Envíos a todo Bolivia</div>
    <div class="header-item"><i class="bi bi-truck"></i> Envíos a todo Bolivia</div>
    <div class="header-item"><i class="bi bi-truck"></i> Envíos a todo Bolivia</div>
    <div class="header-item"><i class="bi bi-truck"></i> Envíos a todo Bolivia</div>
  </div>
</div>

<div class="main">
  <!-- Sidebar: Categorías al costado en PC -->
  <aside class="sidebar">
    <h2>Categorías</h2>
    <div id="menu-cat"></div>
  </aside>

  <!-- Contenido principal -->
  <section>
    <div class="toolbar">
      <input id="searchBox" class="form-control" placeholder="Buscar producto por nombre, código...">
    </div>

    <div id="productos" class="grid"></div>
  </section>
</div>

<a class="whatsapp" href="https://wa.me/59161333335?text=Hola,%20quiero%20cotizar%20por%20mayor%20los%20productos%20del%20cat%C3%A1logo." target="_blank" title="Cotizar por WhatsApp">
  <i class="bi bi-whatsapp"></i> WhatsApp Cotización
</a>

<script type="module">
import { Client, Databases, Query } from "https://cdn.jsdelivr.net/npm/appwrite@14.0.1/+esm";
const ENDPOINT = 'https://fra.cloud.appwrite.io/v1';
const PROJECT  = '692ee6b70012153cd33c';
const DATABASE_ID = '692ee774002e9a3c8601';
const COLLECTION_ID = 'catalogo';

let todos = [];

async function iniciar(){
  const client = new Client().setEndpoint(ENDPOINT).setProject(PROJECT);
  const db = new Databases(client);
  const menu = document.getElementById('menu-cat');
  const grid = document.getElementById('productos');

  try{
    const res = await db.listDocuments(DATABASE_ID, COLLECTION_ID, [Query.limit(200)]);
    todos = res.documents || [];

    // Categorías (sidebar izquierda)
    const cats = Array.from(new Set(todos.map(p => p.categoria || 'General')));
    menu.innerHTML = cats.map((c,i)=>`<button class="btn-cat ${i===0?'active':''}" onclick="filtrar('${c}', this)">${c}</button>`).join('');

    render(todos);
  }catch(e){
    grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;color:#c00;padding:24px">Error cargando catálogo<br><small>${e.message}</small></div>`;
    console.error(e);
  }
}

function render(lista){
  const grid = document.getElementById('productos');
  if(!lista || lista.length===0){
    grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;color:#666;padding:24px">Sin productos</div>`;
    return;
  }
  grid.innerHTML = lista.map(p=>{
    const cod  = p.codigo || '';
    const tit  = p.descripcion || '';
    const pu   = p.precioUnidad ?? '';
    const pm   = p.preciopormayor ?? '';
    const img  = p.imagen || 'https://via.placeholder.com/600x400?text=SIN+FOTO';
    const moqN = parseInt(String(p.moq||'').match(/\d+/)?.[0]||'6',10);
    return `
    <div class="card">
      <div class="img-box">
        <img src="${img}" alt="${tit||cod}" loading="lazy">
      </div>
      <div class="moq">Min. ${isNaN(moqN)?6:moqN} unid.</div>
      <div class="info">
        <h3 class="title">${tit}</h3>
        <div class="ref">Ref: ${cod}</div>
        <div class="prices">
          ${pu?`<span class="old">Bs. ${pu}</span>`:''}
          ${pm?`<span class="price">Bs. ${pm}</span>`:''}
          <span class="cta"><i class="bi bi-fire"></i> PRECIO MAYOR</span>
        </div>
      </div>
    </div>`;
  }).join('');
}

window.filtrar = function(cat, btn){
  document.querySelectorAll('.btn-cat').forEach(b=>b.classList.remove('active'));
  btn?.classList.add('active');
  if(cat==='Todo') render(todos);
  else render(todos.filter(p => (p.categoria||'General')===cat));
};

document.addEventListener('DOMContentLoaded', ()=>{
  const search = document.getElementById('searchBox');
  search.addEventListener('input', ()=>{
    const q = search.value.toLowerCase().trim();
    if(!q) { render(todos); return; }
    render(todos.filter(p =>
      (p.descripcion||'').toLowerCase().includes(q) ||
      (p.codigo||'').toLowerCase().includes(q)
    ));
  });
  iniciar();
});
</script>
</body>
</html>
