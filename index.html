<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Catálogo Mayorista - Ale Importadora</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<style>
:root{ --bg:#f6f8fb; --text:#111; --accent:#FFB800; --accent-dark:#e0a200; --card-border:#e5e5e5; }
*{box-sizing:border-box}
html,body{margin:0;padding:0}
body{background:var(--bg);font-family:Inter,system-ui,sans-serif; color:var(--text);}

/* --- HEADER ROJO Y MARQUESINA --- */
.header-oferta{ 
    width:100%; 
    background:#CC0000; 
    color:#fff; 
    border-bottom:2px solid #8e0000; 
    box-shadow:0 2px 10px rgba(0,0,0,.15); 
    overflow:hidden; 
    position:sticky; 
    top:0; 
    z-index:50; 
    animation: header-pulse 1.5s infinite alternate; 
}
.header-track{ 
    display:flex; 
    gap:40px; 
    white-space:nowrap; 
    animation:marquee 18s linear infinite; 
    padding:12px 0; 
    font-weight:900; 
    font-size:1.1rem; 
    letter-spacing:.5px; 
    text-transform:uppercase; 
    color: #fff;
}
.header-item{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding-left:20px;
    animation: text-pulse 1s infinite alternate;
}
.header-item i { color: var(--accent); } 

/* DEFINICIÓN DE ANIMACIONES */
@keyframes marquee{ 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
@keyframes header-pulse {
    from { background-color: #CC0000; } 
    to { background-color: #E00000; } 
}
@keyframes text-pulse {
    0% { text-shadow: 0 0 5px rgba(255,255,255,0.4); }
    100% { text-shadow: 0 0 10px rgba(255,255,255,0.8); }
}

/* --- TURBO PARA CELULARES --- */
@media (max-width: 768px) {
    .header-track {
        animation-duration: 12s; 
        font-size: 0.9rem;       
        gap: 20px;
    }
}

/* Layout Principal */
.main{ max-width:1600px; margin:0 auto; display:grid; grid-template-columns:260px 1fr; gap:20px; padding:20px; }
@media (max-width:992px){ .main{grid-template-columns:1fr} }

/* Sidebar Categorías */
.sidebar{ background:#fff; border:1px solid var(--card-border); border-radius:12px; padding:16px; position:sticky; top:70px; max-height: calc(100vh - 100px); display: flex; flex-direction: column; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
.sidebar h2{ margin:0 0 12px; font-size:1.1rem; font-weight:900; flex-shrink: 0; }
#menu-cat{ display:flex; flex-direction:column; gap:8px; overflow-y: auto; padding-right: 5px; }
.btn-cat{ background:#fff; color:#444; border:1px solid #ddd; font-weight:700; border-radius:10px; padding:10px 14px; cursor:pointer; font-size:.95rem; text-align:left; transition:.2s; flex-shrink: 0; }
.btn-cat:hover, .btn-cat.active{ background:var(--accent); color:#000; border-color:var(--accent-dark); box-shadow:0 2px 8px rgba(255,184,0,.3); }

/* Toolbar y Chips */
.toolbar-container { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
.toolbar{ background:#fff; border:1px solid var(--card-border); border-radius:12px; padding:14px; display:flex; align-items:center; gap:12px; flex-wrap:wrap; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
#searchBox{ flex:1 1 300px; border:2px solid #eee; outline:none; border-radius:10px; padding:12px 16px; font-size:1rem; transition:0.2s; }
#searchBox:focus{ border-color:var(--accent); }

#sub-chips { display: flex; gap: 8px; flex-wrap: wrap; display: none; }
#sub-chips.visible { display: flex; }
.chip { background: #fff; border: 1px solid #ddd; padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; color: #555; cursor: pointer; transition: 0.2s; }
.chip:hover { background: #eee; }
.chip.active { background: #000; color: #fff; border-color: #000; }

/* Grid de Productos */
.grid{display:grid; gap:20px; grid-template-columns:repeat(5,minmax(0,1fr))}
@media (max-width:1400px){.grid{grid-template-columns:repeat(4,1fr)}}
@media (max-width:992px){.grid{grid-template-columns:repeat(2,1fr)}}
@media (max-width:576px){.grid{grid-template-columns:repeat(1,1fr)}}

/* Tarjetas */
.card{ background:#fff; border:1px solid var(--card-border); border-radius:16px; overflow:hidden; position:relative; display:flex; flex-direction:column; transition:transform 0.2s, box-shadow 0.2s; }
.card:hover{transform:translateY(-4px); box-shadow:0 12px 25px rgba(0,0,0,.08);}
.moq{ position:absolute; top:12px; right:12px; z-index:10; background:var(--accent); color:#000; border-radius:6px; padding:4px 10px; font-weight:800; font-size:.75rem; text-transform: uppercase; }

/* --- EFECTO FLIP 3D --- */
.img-box{ 
    background:#fff; padding:15px; 
    height:220px; 
    border-bottom:1px solid #f0f0f0; 
    position: relative; 
    perspective: 1000px; /* Para la animación 3D */
    cursor: pointer; 
}
.flip-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    text-align: center;
    transition: transform 0.6s;
    transform-style: preserve-3d;
}
.flip-card-inner.flipped {
    transform: rotateY(180deg);
}
.flip-card-front, .flip-card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    -webkit-backface-visibility: hidden; /* Oculta la parte trasera por defecto */
    backface-visibility: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
}
.flip-card-back {
    transform: rotateY(180deg);
}

.prod-img { 
    max-width: 100%;
    max-height:100%; 
    object-fit:contain; 
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05)); 
}

/* INDICADOR DE FOTO EXTRA (La flecha) */
.indicator-arrow {
    position: absolute;
    top: 50%;
    right: 10px;
    transform: translateY(-50%);
    color: rgba(0, 0, 0, 0.5); 
    font-size: 1.5rem;
    z-index: 30;
    pointer-events: none;
    transition: color 0.3s;
}
.img-box:hover .indicator-arrow {
    color: var(--accent); 
}

.info{padding:16px;}
.title{font-size:1.05rem; font-weight:900; margin:0 0 6px; line-height:1.4; color:#000;}
.ref{font-size:.85rem; color:#888; font-weight:600; margin-bottom:12px;}
.prices{display:flex; align-items:flex-end; gap:8px; flex-wrap:wrap; margin-bottom:10px;}
.price{font-weight:900; font-size:1.25rem; color:#111;}
.old-price{font-size:0.9rem; color:#999; text-decoration:line-through; margin-bottom:3px;}
.cta{ background:#000; color:#fff; border-radius:8px; padding:8px 12px; font-weight:800; font-size:.85rem; display:inline-flex; align-items:center; gap:6px; width:100%; justify-content:center; }

/* Botón WhatsApp */
.whatsapp{ position:fixed; right:20px; bottom:20px; z-index:100; background:#25D366; color:#fff; border-radius:50px; padding:12px 24px; font-weight:800; text-decoration:none; box-shadow:0 4px 20px rgba(37,211,102,0.4); display:flex; align-items:center; gap:8px; transition:transform 0.2s; font-size:1rem; }
.whatsapp:hover{transform:scale(1.05);}

@media (max-width:992px){ .sidebar{position:static; margin-bottom:20px; max-height:none;} #menu-cat{flex-direction:row; flex-wrap:wrap; overflow-y:visible;} .btn-cat{flex:1; text-align:center; white-space:nowrap;} }
</style>
</head>
<body>

<div class="header-oferta">
    <div class="header-track">
        <!-- MENSAJE DINÁMICO FINAL -->
        <div class="header-item"><i class="bi bi-fire"></i> ¡GRAN OFERTA! ¡APROVECHA AHORA!</div>
        <div class="header-item"><i class="bi bi-tags-fill"></i> ¡35% DESCUENTO TOTAL!</div>
        <div class="header-item"><i class="bi bi-fire"></i> ¡GRAN OFERTA! ¡APROVECHA AHORA!</div>
        <div class="header-item"><i class="bi bi-tags-fill"></i> ¡35% DESCUENTO TOTAL!</div>
    </div>
</div>

<div class="main">
  <aside class="sidebar">
    <h2><i class="bi bi-grid-fill"></i> Categorías</h2>
    <div id="menu-cat"><div style="color:#888; font-size:0.9rem">Cargando...</div></div>
  </aside>

  <section>
    <div class="toolbar-container">
        <div class="toolbar">
            <i class="bi bi-search" style="font-size:1.2rem; color:#aaa"></i>
            <input id="searchBox" placeholder="¿Qué estás buscando hoy?">
        </div>
        <div id="sub-chips"></div>
    </div>

    <div id="productos" class="grid"></div>
  </section>
</div>

<a class="whatsapp" href="https://wa.me/59161333335?text=Hola,%20vi%20su%20cat%C3%A1logo%20web%20y%20quiero%20hacer%20un%20pedido." target="_blank"><i class="bi bi-whatsapp" style="font-size:1.3rem"></i> Hacer Pedido</a>


<script type="module">
import { Client, Databases, Query } from "https://cdn.jsdelivr.net/npm/appwrite@14.0.1/+esm";
const PROJECT_ID = '692ee6b70012153cd33c'; const DATABASE_ID = '692ee774002e9a3c8601'; const COLLECTION_ID = 'catalogo';

let todos = [];
let catActual = 'Todo';

// --- FUNCIÓN DE FLIP CARD (Se activa al hacer click o tap) ---
window.flipCard = function(cardId) {
    const cardElement = document.getElementById(cardId);
    if (!cardElement) return;

    const innerCard = cardElement.querySelector('.flip-card-inner');
    const indicator = cardElement.querySelector('.indicator-arrow');
    
    // Solo permitir flip si hay indicador (es decir, si hay imagen2)
    if (!indicator) return;

    // Alternar la clase 'flipped'
    innerCard.classList.toggle('flipped');
    
    // Cambiar el indicador
    if (innerCard.classList.contains('flipped')) {
        indicator.className = 'indicator-arrow bi bi-arrow-return-left'; // Icono para regresar
    } else {
        indicator.className = 'indicator-arrow bi bi-chevron-right'; // Icono para avanzar
    }
}

// --- LÓGICA DE INICIO Y FILTRADO ---

async function iniciar(){
  const client = new Client().setEndpoint('https://fra.cloud.appwrite.io/v1').setProject(PROJECT_ID);
  const db = new Databases(client);
  const grid = document.getElementById('productos');
  try {
    const res = await db.listDocuments(DATABASE_ID, COLLECTION_ID, [Query.limit(200), Query.orderDesc('$createdAt')]);
    todos = res.documents.filter(doc => doc.disponible !== false);
    renderCategorias(); 
    renderProductos(todos);
  } catch(e) { console.error(e); grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:50px;"><p style="color:#666;">No se pudo cargar el catálogo.</p></div>`; }
}

function formatearTexto(txt) { if(!txt) return ''; const lower = txt.toLowerCase().trim(); return lower.charAt(0).toUpperCase() + lower.slice(1); }
function formatearTitulo(txt) { if(!txt) return 'Sin Nombre'; const lower = txt.toLowerCase().trim(); return lower.split(' ').map(palabra => palabra.charAt(0).toUpperCase() + palabra.slice(1)).join(' '); }
function formatearCodigo(txt) { if(!txt) return ''; return txt.toUpperCase().trim(); }

// 1. Sidebar Categorías
function renderCategorias(){
  const menu = document.getElementById('menu-cat');
  let categoriasLimpias = todos.map(p => formatearTexto(p.categoria || 'Varios'));
  let listadoCategorias = [...new Set(categoriasLimpias)]; listadoCategorias.sort();
  const cats = ['Todo', ...listadoCategorias];
  menu.innerHTML = cats.map(c => `<button class="btn-cat ${c==='Todo'?'active':''}" onclick="filtrar('${c}', this)">${c}</button>`).join('');
}

// 2. Filtrado y Chips
window.filtrar = function(cat, btn){
  if(btn){ document.querySelectorAll('.btn-cat').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
  catActual = cat;
  let filtrados = [];
  if(cat === 'Todo') { 
      filtrados = todos; 
      document.getElementById('sub-chips').classList.remove('visible'); 
  } else { 
      filtrados = todos.filter(p => formatearTexto(p.categoria) === cat);
      renderSubCategorias(filtrados);
  }
  renderProductos(filtrados);
}

function renderSubCategorias(listaProductos){
    const container = document.getElementById('sub-chips');
    const tipos = listaProductos.map(p => p.tipo ? formatearTexto(p.tipo) : null).filter(t => t !== null);
    const tiposUnicos = [...new Set(tipos)];
    
    if(tiposUnicos.length > 0){
        container.classList.add('visible');
        let html = `<div class="chip active" onclick="filtrarSub('todos', this)">Ver todo</div>`;
        html += tiposUnicos.map(t => `<div class="chip" onclick="filtrarSub('${t}', this)">${t}</div>`).join('');
        container.innerHTML = html;
    } else {
        container.classList.remove('visible'); container.innerHTML = '';
    }
}

window.filtrarSub = function(tipo, btn){
    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    btn.classList.add('active');
    const base = todos.filter(p => formatearTexto(p.categoria) === catActual);
    if(tipo === 'todos'){ renderProductos(base); } else { renderProductos(base.filter(p => formatearTexto(p.tipo) === tipo)); }
}

// 3. Grid Productos
function renderProductos(lista){
  const grid = document.getElementById('productos');
  if(lista.length === 0){ grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:50px; color:#888;">Sin productos.</div>`; return; }
  
  grid.innerHTML = lista.map(p => {
    const tituloBonito = formatearTitulo(p.descripcion);
    const codigoBonito = formatearCodigo(p.codigo);
    let valorPrecio = parseFloat(p.preciopormayor); if(isNaN(valorPrecio)) valorPrecio = 0;
    const precio = valorPrecio.toFixed(2);
    
    let precioViejoHtml = '';
    if(p.precioUnidad) { let valUnidad = parseFloat(p.precioUnidad); if(!isNaN(valUnidad)) precioViejoHtml = `<div class="old-price">Bs. ${valUnidad.toFixed(2)}</div>`; }

    const tieneFoto2 = p.imagen2 ? true : false;
    const cardId = `card-${p.$id}`;
    
    let indicatorHtml = '';
    let imgBoxClick = '';

    if (tieneFoto2) {
        indicatorHtml = `<i class="indicator-arrow bi bi-chevron-right"></i>`;
        imgBoxClick = `onclick="flipCard('${cardId}')"`;
    } 
    
    return `
    <div class="card" id="${cardId}">
      <div class="moq">Mín. ${p.moq || 6} unid.</div>
      <div class="img-box" ${imgBoxClick}>
          <div class="flip-card-inner">
              <!-- Imagen Frontal -->
              <div class="flip-card-front">
                  <img src="${p.imagen}" class="prod-img" loading="lazy">
              </div>
              <!-- Imagen Trasera (Solo si existe p.imagen2) -->
              <div class="flip-card-back">
                  <img src="${p.imagen2 || p.imagen}" class="prod-img" loading="lazy">
              </div>
          </div>
          ${indicatorHtml}
      </div>
      <div class="info">
        <h3 class="title">${tituloBonito}</h3>
        <div class="ref">Ref: ${codigoBonito}</div>
        <div class="prices"><div>${precioViejoHtml}<div class="price">Bs. ${precio}</div></div></div>
        <div class="cta"><i class="bi bi-fire"></i> PRECIO POR MAYOR</div>
      </div>
    </div>`;
  }).join('');
}

document.getElementById('searchBox').addEventListener('input', (e)=>{
  const q = e.target.value.toLowerCase();
  renderProductos(todos.filter(p => (p.descripcion||'').toLowerCase().includes(q) || (p.codigo||'').toLowerCase().includes(q)));
});

iniciar();
</script>
</body>
</html>
