<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo Mayorista - Final</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <style>
        body { 
            background-color: #f0f2f5; 
            font-family: 'Inter', sans-serif; 
            padding-bottom: 80px; 
        }

        /* HEADER AZUL FUERTE (ESTILO WALMART) */
        .header-clean {
            background-color: #0071DC; 
            color: white; padding: 15px; position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* BARRA DE CATEGORÍAS */
        .categorias-wrapper {
            background: white; padding: 10px 0; position: sticky; top: 60px; z-index: 900;
            overflow-x: auto; white-space: nowrap; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .btn-cat {
            background: #f8f9fa; color: #333; padding: 8px 20px; border-radius: 20px; margin: 0 5px; font-weight: 600; text-transform: capitalize;
        }
        .btn-cat.active { background: #0071DC; color: white; border-color: #0071DC; }

        /* TARJETA DE PRODUCTO */
        .card-image-focus {
            background: white; border-radius: 8px; overflow: hidden; height: 100%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08); 
            display: flex; flex-direction: column;
        }

        /* ZONA DE FOTO (GRANDE) */
        .img-zona { height: 250px; background: #fff; border-bottom: 1px solid #eee; position: relative; padding: 10px; }
        .img-zona img { width: 100%; height: 100%; object-fit: contain; }
        .carousel, .carousel-inner, .carousel-item { height: 100%; }

        /* ETIQUETA DE MÍNIMO DE COMPRA (MOQ) */
        .moq-badge {
            position: absolute; top: 0; right: 0; z-index: 10;
            background-color: #0071DC; color: white; padding: 4px 8px; font-size: 0.8rem; font-weight: 700;
            border-bottom-left-radius: 8px;
        }

        .info-zona { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .titulo-prod { font-size: 0.95rem; font-weight: 600; color: #333; height: 2.4em; overflow: hidden; }

        /* PRECIOS (VERDE GANANCIA - FOCO) */
        .precio-mayor-valor { 
            font-size: 1.8rem; 
            color: #198754; 
            font-weight: 900; 
            line-height: 1;
        }
        
        /* Precio Unidad (Secundario/Tachado) */
        .precio-unidad-valor { font-size: 0.9rem; color: #999; text-decoration: line-through; }
        .precio-unidad-label { font-size: 0.7rem; color: #999; }
        
        .action-block { padding-top: 10px; margin-top: auto; }

        .btn-whatsapp-card {
            margin-top: 8px; background-color: #25D366; color: white; border: none; width: 100%;
            padding: 8px; border-radius: 6px; font-weight: 600; text-align: center; text-decoration: none;
        }
    </style>
</head>
<body>

    <div class="header-clean d-flex justify-content-between align-items-center">
        <div class="container d-flex justify-content-between align-items-center">
            <div class="fw-bold fs-5"><i class="bi bi-person-workspace"></i> Catálogo MAYORISTA</div>
            <div class="badge bg-light text-secondary border" id="contador">0 Productos</div>
        </div>
    </div>

    <div class="categorias-wrapper" id="menu-cat"></div>

    <div class="container-fluid px-2 mt-3">
        <div id="productos" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-3">
            <div class="col-12 text-center py-5"><div class="spinner-border text-secondary"></div></div>
        </div>
    </div>

    <script type="module">
        import { Client, Databases } from "https://cdn.jsdelivr.net/npm/appwrite@14.0.1/+esm";

        // CONFIGURACIÓN VITAL
        const MI_WHATSAPP = "59170000000"; 
        const DEFAULT_MOQ = "6 UNID"; 
        let todosLosProductos = [];
        
        async function iniciar() {
            const divProd = document.getElementById('productos');
            const menuCat = document.getElementById('menu-cat');
            const spanCount = document.getElementById('contador');

            try {
                // CONEXIÓN FRANKFURT Y TUS IDS
                const client = new Client()
                    .setEndpoint('https://fra.cloud.appwrite.io/v1') 
                    .setProject('692ee6b70012153cd33c');             

                const databases = new Databases(client);

                const res = await databases.listDocuments('692ee774002e9a3c8601', 'catalogo');
                todosLosProductos = res.documents;
                spanCount.innerText = `${todosLosProductos.length} Productos`;

                // GENERAR CATEGORÍAS
                const categorias = new Set();
                todosLosProductos.forEach(p => categorias.add(p['categoria'] || 'General'));
                let htmlMenu = `<button class="btn-cat active" onclick="window.filtrar('Todo', this)">Todo</button>`;
                categorias.forEach(cat => {
                    htmlMenu += `<button class="btn-cat" onclick="window.filtrar('${cat}', this)">${cat}</button>`;
                });
                menuCat.innerHTML = htmlMenu;

                // MOSTRAR TODO
                renderizar(todosLosProductos);

            } catch (error) {
                divProd.innerHTML = `<div class="text-danger text-center p-4">Error: ${error.message}</div>`;
            }
        }

        function renderizar(lista) {
            const divProd = document.getElementById('productos');
            let html = '';

            if (lista.length === 0) {
                divProd.innerHTML = '<div class="col-12 text-center text-muted py-5">No hay productos.</div>';
                return;
            }

            lista.forEach((p, index) => {
                const codigo = p['codigo'] || 'S/C';
                const desc = p['descripcion'] || 'Producto Mayorista';
                const precioU = p['precioUnidad'] || '0'; 
                const precioM = p['preciopormayor'] || '0'; 
                const moq = p['moq'] || DEFAULT_MOQ; 
                
                // Recolectar imágenes para carrusel
                const imagenes = [];
                if(p['imagen']) imagenes.push(p['imagen']);
                if(p['imagen2']) imagenes.push(p['imagen2']);
                if(p['imagen3']) imagenes.push(p['imagen3']);
                if(imagenes.length === 0) imagenes.push('https://via.placeholder.com/400?text=SIN+FOTO');

                const linkWs = `https://wa.me/${MI_WHATSAPP}?text=${encodeURIComponent("Hola, me interesa el producto mayorista: " + desc + " (Cod: " + codigo + ").")}`;

                // Lógica Carrusel
                let htmlImagen = '';
                if (imagenes.length > 1) {
                    let itemsHtml = '';
                    imagenes.forEach((imgUrl, i) => {
                        itemsHtml += `<div class="carousel-item ${i===0 ? 'active' : ''}"><img src="${imgUrl}" alt="Foto ${i+1}"></div>`;
                    });

                    htmlImagen = `
                        <div id="carousel-${index}" class="carousel slide" data-bs-interval="false">
                            <div class="carousel-inner">${itemsHtml}</div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#carousel-${index}" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon"></span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carousel-${index}" data-bs-slide="next">
                                <span class="carousel-control-next-icon"></span>
                            </button>
                        </div>
                    `;
                } else {
                    htmlImagen = `<img src="${imagenes[0]}" alt="${codigo}">`;
                }

                html += `
                    <div class="col">
                        <div class="card-image-focus">
                            
                            <div class="moq-badge">MIN. ${moq}</div>
                            
                            <div class="img-zona">
                                ${htmlImagen}
                            </div>

                            <div class="info-zona">
                                <h5 class="titulo-prod mb-1">${desc}</h5>
                                <div class="codigo-text mb-3">REF: ${codigo}</div>

                                <div class="action-block">
                                    <div class="d-flex justify-content-between align-items-end mb-2">
                                        <div class="text-start">
                                            <p class="precio-unidad-label mb-0">Precio Venta</p>
                                            <div class="precio-unidad-valor">Bs. ${precioU}</div>
                                        </div>
                                        <div class="text-end">
                                            <p class="precio-mayor-valor">Bs. ${precioM}</p>
                                            <p class="precio-unidad-label mb-0" style="color: #198754; font-weight: 700;">PRECIO MAYOR</p>
                                        </div>
                                    </div>
                                    
                                    <a href="${linkWs}" target="_blank" class="btn-whatsapp-card">
                                        <i class="bi bi-whatsapp"></i> Pedir por WhatsApp
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            divProd.innerHTML = html;
        }

        window.filtrar = function(categoria, btn) {
            document.querySelectorAll('.btn-cat').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if (categoria === 'Todo') renderizar(todosLosProductos);
            else renderizar(todosLosProductos.filter(p => (p['categoria'] || 'General') === categoria));
        }

        iniciar();
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
